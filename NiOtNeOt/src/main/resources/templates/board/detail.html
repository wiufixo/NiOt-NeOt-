<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">

<div th:replace="fragments/common :: head('board detail')"></div>

<body style="padding-top: 110px;">

	<div th:replace="fragments/common :: header('detail')"></div>


	<div class="modal fade" id="comment-modal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">update comment</h5>
					<button type="button" class="btn-close" data-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<form>
						<input type="hidden" id="bc_no"> <input type="hidden" id="b_no">
						<div class="mb-3">
							<label for="cu_no" class="col-form-label">�옉�꽦�옄:</label> <input type="text" class="form-control" id="cu_id" readonly="readonly">
						</div>
						<div class="mb-3">
							<label for="bc_content" class="col-form-label">�궡�슜:</label>
							<textarea class="form-control" id="bc_content"></textarea>
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" id="btn-modal-cancel" data-dismiss="modal">cancel</button>
					<button type="button" class="btn btn-primary" id="btn-modal-update">update</button>
				</div>
			</div>
		</div>
	</div>


	<!-- <h2>[[${principal.username}]]</h2> -->
	<div class="container">
		<div class="box-content">
			<input type="hidden" id="page" th:value="${params.page}"> <input type="hidden" id="searchType" th:value="${params.searchType}"> <input type="hidden" id="keyword" th:value="${params.keyword}">
			<form th:object="${board}">
				<input type="hidden" id="board_no" th:value="*{b_no}">
				<div class="form-group">
					<label for="title">�젣紐�</label>
					<p class="form-control" th:text="*{b_title}"></p>
				</div>
				<div class="form-group">
					<label for="writer">�옉�꽦�옄</label>
					<p class="form-control" th:text="*{user.cu_id}"></p>
				</div>
				<div class="form-group">
					<label for="content">�궡�슜</label>
					<textarea class="form-control" th:text="*{b_content}"></textarea>
				</div>
				<div class="form-group">
					<label for="created">�벑濡앹씪</label>
					<p class="form-control" th:text="*{b_created}"></p>
				</div>
				<div class="form-group">
					<label for="hit">議고쉶�닔</label>
					<p class="form-control" th:text="*{b_hit}"></p>
				</div>


				<div th:if="${not #lists.isEmpty( fileList )}" class="form-group">
					<label for="inp-type-4" class="col-sm-2 control-label">File</label>
					<div class="col-sm-10">
						<div class="form-control file_list">
							<div th:each="row, status : ${fileList}">
								<a th:href="@{/board/download(bf_no=${row.bf_no})}"> 
								<i class="fa fa-file-o" aria-hidden="true"></i> 
								[[ ${row.original_name} ]]
								</a> 
								<span th:text="|${row.size}kb|"></span>
							</div>
							<br>
						</div>
					</div>
				</div>

				<div class="text-right my-btn">
					<a th:if="${#authentication.name==board.user.cu_id}" class="btn btn-primary" th:href="@{/board/form(b_no=*{b_no},page=${params.page},searchType=${params.searchType},keyword=${params.keyword})}">湲��닔�젙</a>
					<button th:if="${#authentication.name==board.user.cu_id}" class="btn btn-warning" id="btn-delete" type="button">湲��궘�젣</button>
					<!-- <a class="btn btn-secondary" th:href="@{/board/list}">紐⑸줉�쑝濡�</a> -->
					<a class="btn btn-secondary" th:href="@{/board/list(page=${params.page},searchType=${params.searchType},keyword=${params.keyword})}">紐⑸줉�쑝濡�</a>
				</div>
			</form>
		</div>

		<div class="box-content">
			<div class="clearfix" style="padding: 10px;">
				<h4 class="box-title pull-left">Comment</h4>
			</div>
			<form class="form-horizontal form-view">
				<div class="input-group margin-bottom-20">
					<input class="form-control" id="comment-content" type="text">
					<div class="input-group-btn" style="margin-left: 10px;">
						<button class="btn waves-effect waves-light" id="btn-comment-save" type="button">
							<i class="fa fa-commenting" aria-hidden="true"></i>
						</button>
					</div>
				</div>
				<ul class="notice-list"></ul>
			</form>
		</div>

	</div>



	<div th:replace="fragments/common :: footer"></div>

	<div th:replace="fragments/common :: js"></div>

	<script th:inline="javascript"> 
			
			
			const user = /*[[${principal.username}]]*/		
			console.log(user) //�쁽�옱�젒�냽�븳�쑀���븘�씠�뵒
			
			
			printCommentList();
			
			function printCommentList() {
				const b_no = $("#board_no").val();
				$.ajax({
					url:`/boardComment/list/${b_no}`,
					success:function(data){
						let commentsHtml = '';
						$(data).each(function(){
							commentsHtml += `<li style="margin-bottom:20px; padding-bottom:30px;">
												<span class="name">${this.user.cu_id}</span>
												<span class="desc" style="margin-top:15px;">${this.bc_content}</span>
												<span class="time">${this.bc_created}</span>
												<span class="time" style="margin-top:30px;" id="btns">`;
							if(user==this.user.cu_id){
									commentsHtml += `<button type="button" class="btn btn-outline-secondary btn-sm" onclick="deleteComment(${this.bc_no})">�궘�젣</button>
													<button type="button" class="btn btn-outline-primary btn-sm" onclick="commentUpdate(${this.bc_no},${b_no},'${this.user.cu_id}','${this.bc_content}')">�닔�젙</button>`;
							};
							commentsHtml += `</span>
											</li>`;
						});
						$(".notice-list").html(commentsHtml); //append媛� �븘�땲�씪 html�엫�쑝濡� empty()�븯吏� �븡�븘�룄 �맂�떎
					}
				});
			};
			
			
			function commentUpdate(bc_no, b_no, cu_id, bc_content){
				$("#comment-modal").modal("toggle");
				$("#bc_no").val(bc_no);
				$("#b_no").val(b_no);
				$("#cu_id").val(cu_id);
				$("#bc_content").val(bc_content);
			};
			
			
			$("#btn-modal-update").on("click", function(){
				const bc_no = $("#bc_no").val();
				const bc_content = $("#bc_content").val();
				const data = {
					bc_no: bc_no,
					bc_content : bc_content
				};
				$.ajax({
					url:"/boardComment/update",
					type:"put",
					data:JSON.stringify(data),
					contentType:"application/json; charset=utf-8",
					success:function(){
						$("#comment-modal").modal("hide");
						alert("�뙎湲��닔�젙�쓣 �꽦怨듯븯���뒿�땲�떎!");
						printCommentList();
					},
					error: function(xhr, status, error) {
						alert("�뿉�윭媛� 諛쒖깮�븯���뒿�땲�떎.");
						return false;
					}
				});
			});
			
			
			
			$("#btn-comment-save").on("click", function(){
				const content = $("#bc_content");
				const b_no = $("#board_no").val();
				const bc_content = $("#comment-content").val();
				if (isEmpty(bc_content)) {
					$("#comment-content").attr("placeholder", "�뙎湲��쓣 �엯�젰�빐 二쇱꽭�슂.");
					$("#comment-content").focus();
					return false;
				};
			
				const data = {
					b_no : b_no,
					bc_content : bc_content
				};
			
				$.ajax({
					url:`/boardComment/save/${b_no}`,
					type:"post",
					data:data,
					success:function(){
						$("#comment-modal").modal("hide");
						alert("�뙎湲��벑濡앹쓣 �꽦怨듯븯���뒿�땲�떎!");
						$("#comment-content").val("");
						printCommentList();
					},
					error: function(xhr, status, error) {
						alert("�뿉�윭媛� 諛쒖깮�븯���뒿�땲�떎.");
						return false;
					}
				});
			});
		
			
			$("#btn-delete").on("click", function(){
				const b_no = $("#board_no").val();
				const page = $("#page").val();
				const searchType = $("#searchType").val();
				const keyword = $("#keyword").val();
				if(re = confirm(`${b_no}踰� 寃뚯떆臾쇱쓣 �젙留� �궘�젣�븯�떆寃좎뒿�땲源�?`)){
					$.ajax({
						url:`/board/delete/${b_no}`,
						type:"delete",
						success:function(){
							alert("湲��궘�젣瑜� �꽦怨듯뻽�뒿�땲�떎!");
							location.href = `/board/list?page=${page}&searchType=${searchType}&keyword=${keyword}`;
						}
					});
				};
			});
			
			
			function deleteComment(bc_no){
				if(re = confirm(`${bc_no}踰� 寃뚯떆臾쇱쓣 �젙留� �궘�젣�븯�떆寃좎뒿�땲源�?`)){
					$.ajax({
						url:`/boardComment/delete/${bc_no}`,
						type:"delete",
						success:function(){
							alert("�뙎湲��궘�젣瑜� �꽦怨듯뻽�뒿�땲�떎!");
							printCommentList();
						},
						error: function(xhr, status, error) {
							alert("�뿉�윭媛� 諛쒖깮�븯���뒿�땲�떎.");
							return false;
						}
					});
				};
			};
			
	
	
	
	
	
	
	
	
	
	
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		

		
		
	</script>


</body>


</html>